<!DOCTYPE html>
<html dir="ltr" lang="en" class="">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"
    />
    <title>Tree View</title>

    <script type="module" src="/build/gemini.esm.js"></script>
    <script nomodule src="/build/gemini.js"></script>
    <link href="/build/gemini.css" rel="stylesheet" />

    <style>
      * {
        box-sizing: border-box;
      }

      body {
        display: flex;
        margin: 0;
        min-height: 100vh;
        background-color: var(--color-background);
      }

      .main-container {
        display: grid;
        grid-auto-rows: min-content;
        align-self: stretch;
        width: 100%;
        padding-inline: 16px;
      }

      .section-dev {
        height: 55vh;
      }

      .scroll {
        overflow-y: auto;
        height: 100%;
      }

      .ch-tree-x-list-item--success::part(action)::before {
        grid-area: first-img;
        content: "";
        width: 12px;
        height: 12px;
        margin-inline-end: 4px;
        background-color: rgb(69, 150, 96);
        border-radius: 50%;
      }

      .ch-tree-x-list-item--success::part(action) {
        grid-template: "first-img left-img text right-img" / max-content max-content 1fr max-content;
      }

      .configuration {
        display: grid;
        grid-template-columns: max-content max-content max-content max-content;
        grid-template-rows: min-content min-content min-content min-content;
        gap: 12px 24px;
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <section
        class="section-dev"
        style="
          display: grid;
          grid-template-columns: 200px;
          gap: 32px;
          margin: 50px;
        "
      >
        <div class="scroll">
          <gxg-tree-view></gxg-tree-view>
        </div>
      </section>

      <div class="configuration">
        <div>
          <input id="input-scroll-into-visible" type="text" />
          <button id="btn-scroll-into-visible" type="button">
            Scroll into visible
          </button>
        </div>

        <ch-checkbox
          id="multi-selection"
          checkedValue="true"
          unCheckedValue="false"
          value="false"
          caption="Multi selection"
        ></ch-checkbox>

        <ch-checkbox
          id="check-all"
          checkedValue="true"
          unCheckedValue="false"
          value="false"
          caption="Check / uncheck all"
        ></ch-checkbox>

        <label>
          Lines
          <select name="lines" id="lines">
            <option value="all">All lines</option>
            <option value="last">Last line</option>
            <option value="none" selected>None</option>
          </select>
        </label>

        <button id="expand-all" type="button">Expand All</button>

        <button id="collapse-all" type="button">Collapse All</button>
      </div>

      <button type="outlined" id="get-selected-markup">
        Get Selected Items
      </button>
      <button type="outlined" id="get-checked-markup">Get Checked Items</button>
      <button type="outlined" id="open-goat-b">Open Goat B</button>
      <button type="outlined" id="close-goat-b">Close Goat B</button>
      <button type="outlined" id="toggle-goat-b">Toggle Goat B</button>

      <div class="buttons-wrapper">
        <button id="load-model-btn">Load model (click first)</button>
        <button id="update-model-btn">Update model (click second)</button>
        <button id="update-model-again-btn">
          Update model again (click third)
        </button>
        <button id="update-big-model-btn">Set big model</button>
      </div>
    </div>

    <script>
      const modelTiny = [
        {
          id: "number-1",
          caption: "number-1 label",
          leftImgSrc: "../assets/icons/knowledge-base.svg",
        },
        {
          id: "number-2",
          caption: "number-2",
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-2.1",
              caption: "number-2.1",
              leftImgSrc: "../assets/icons/file.svg",
            },
          ],
        },
        {
          id: "number-3",
          caption: "number-3",
          leftImgSrc: "/build/ch-icon-assets/patterns.svg",
          items: [
            {
              id: "number-3.1",
              caption: "number-3.1",
              leftImgSrc: "/build/ch-icon-assets/java.svg",
            },
          ],
        },
      ];
      const modelTinyUpdated = [
        {
          id: "number-1",
          caption: "number-1",
          leftImgSrc: "./build/ch-icon-assets/csharp.svg.svg",
        },
        {
          id: "number-2",
          caption: "number-2",
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-2.1",
              caption: "number-2.1",
              leftImgSrc: "/build/ch-icon-assets/patterns.svg",
              items: [
                {
                  id: "number-2.1.1",
                  caption: "number-2.1.1",
                  leftImgSrc: "/build/ch-icon-assets/java.svg",
                },
              ],
            },
          ],
        },
        {
          id: "number-3",
          caption: "number-3",
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-3.1",
              caption: "number-3.1",
              leftImgSrc: "../assets/icons/datastore.svg",
            },
          ],
        },
      ];

      const modelTinyUpdatedAgain = [
        {
          id: "number-a",
          caption: "number-a",
          leaf: true,
          leftImgSrc: "../assets/icons/apple.svg",
        },
        {
          id: "number-b",
          caption: "number-b",
          leaf: false,
          leftImgSrc: "../assets/icons/file.svg",
          items: [
            {
              id: "number-2.1",
              caption: "number-2.1",
              leaf: false,
              leftImgSrc: "/build/ch-icon-assets/patterns.svg",
              items: [
                {
                  id: "number-2.1.1",
                  caption: "number-2.1.1",
                  leaf: false,
                  leftImgSrc: "/build/ch-icon-assets/java.svg",
                  items: [
                    {
                      id: "number-2.1.1.1",
                      caption: "number-2.1.1.1",
                      leaf: true,
                      leftImgSrc: "/build/tree-item-assets/download.svg",
                    },
                  ],
                },
              ],
            },
          ],
        },
        {
          id: "number-3",
          caption: "number-3",
          leaf: true,
          leftImgSrc: "/build/ch-icon-assets/patterns.svg",
        },
      ];

      const model = [
        {
          id: "number-1",
          caption: "number-1 label",
          leaf: false,
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-1-1",
              caption: "number-1-1",
              leaf: false,
              leftImgSrc: "/build/ch-icon-assets/patterns.svg",
              items: [
                {
                  id: "number-1-1-1",
                  caption: "number-1-1-1",
                  leaf: true,
                  leftImgSrc: "../assets/icons/knowledge-base.svg",
                },
                {
                  id: "number-1-1-2",
                  caption: "number-1-1-2",
                  leaf: false,
                  leftImgSrc: "../assets/icons/knowledge-base.svg",
                  items: [
                    {
                      id: "number-1-1-2-1",
                      caption: "number-1-1-2-1 (lazy)",
                      leaf: false,
                      leftImgSrc: "../assets/icons/knowledge-base.svg",
                      lazy: true,
                      checkbox: true,
                      toggleCheckboxes: true,
                    },
                    {
                      id: "number-1-1-2-2",
                      caption: "number-1-1-2-2",
                      leaf: true,
                      leftImgSrc: "/build/ch-icon-assets/java.svg",
                    },
                  ],
                },
              ],
            },
            {
              id: "number-1-2",
              caption: "number-1-2",
              leaf: true,
              leftImgSrc: "../assets/icons/knowledge-base.svg",
            },
          ],
        },
        {
          id: "number-2",
          caption: "number-2",
          leaf: false,
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-2-1",
              caption: "number-2-1",
              leaf: true,
              leftImgSrc: "/build/ch-icon-assets/java.svg",
            },
            {
              id: "number-2-2",
              caption: "number-2-2",
              leaf: true,
              leftImgSrc: "../assets/icons/knowledge-base.svg",
            },
          ],
        },
      ];

      const updatedModel = [
        {
          id: "number-1",
          caption: "number-1",
          leaf: false,
          leftImgSrc: "../assets/icons/knowledge-base.svg",
          items: [
            {
              id: "number-1-1",
              caption: "number-1-1",
              class: "ch-tree-x-list-item--success",
              leaf: false,
              leftImgSrc: "../assets/icons/knowledge-base.svg",
              items: [
                {
                  id: "number-1-1-1",
                  caption: "number-1-1-1",
                  leaf: true,
                  leftImgSrc: "../assets/icons/knowledge-base.svg",
                },
                {
                  id: "number-1-1-2",
                  caption: "number-1-1-2",
                  leaf: false,
                  leftImgSrc: "../assets/icons/knowledge-base.svg",
                  items: [
                    {
                      id: "number-1-1-2-1",
                      caption: "number-1-1-2-1",
                      leaf: false,
                      leftImgSrc: "../assets/icons/knowledge-base.svg",
                      items: [
                        {
                          id: "new-item-added-1",
                          caption: "new-item-added-1",
                          disabled: true,
                          leaf: true,
                          leftImgSrc: "../assets/icons/knowledge-base.svg",
                        },
                        {
                          id: "new-item-added-2",
                          caption: "new-item-added-2",
                          disabled: false,
                          leaf: true,
                          leftImgSrc: "../assets/icons/knowledge-base.svg",
                        },
                        {
                          id: "new-item-added-3",
                          caption: "new-item-added-3",
                          disabled: true,
                          leaf: true,
                          leftImgSrc: "../assets/icons/knowledge-base.svg",
                        },
                        {
                          id: "new-item-added-4",
                          caption: "new-item-added-4",
                          disabled: false,
                          expanded: true,
                          leaf: false,
                          leftImgSrc: "../assets/icons/knowledge-base.svg",
                          items: [
                            {
                              id: "new-item-added-4-1",
                              caption: "new-item-added-4-1",
                              disabled: false,
                              leaf: true,
                              leftImgSrc: "../assets/icons/knowledge-base.svg",
                            },
                            {
                              id: "new-item-added-4-2",
                              caption: "new-item-added-4-2",
                              disabled: true,
                              expanded: true,
                              leaf: false,
                              leftImgSrc: "../assets/icons/knowledge-base.svg",
                              items: [
                                {
                                  id: "new-item-added-4-2-1",
                                  caption: "new-item-added-4-2-1",
                                  disabled: true,
                                  expanded: true,
                                  leaf: false,
                                  leftImgSrc:
                                    "../assets/icons/knowledge-base.svg",
                                  items: [
                                    {
                                      id: "new-item-added-4-2-1-1",
                                      caption: "new-item-added-4-2-1-1",
                                      disabled: false,
                                      leaf: true,
                                      leftImgSrc:
                                        "../assets/icons/knowledge-base.svg",
                                    },
                                    {
                                      id: "new-item-added-4-2-1-2",
                                      caption: "new-item-added-4-2-1-2",
                                      disabled: false,
                                      leaf: true,
                                      leftImgSrc:
                                        "../assets/icons/knowledge-base.svg",
                                    },
                                    {
                                      id: "new-item-added-4-2-1-3",
                                      caption: "new-item-added-4-2-1-3",
                                      disabled: true,
                                      leaf: true,
                                      leftImgSrc:
                                        "../assets/icons/knowledge-base.svg",
                                    },
                                    {
                                      id: "new-item-added-4-2-1-4",
                                      caption: "new-item-added-4-2-1-4",
                                      disabled: false,
                                      leaf: true,
                                      leftImgSrc:
                                        "../assets/icons/knowledge-base.svg",
                                    },
                                  ],
                                },
                                {
                                  id: "new-item-added-4-2-2",
                                  caption: "new-item-added-4-2-2",
                                  disabled: true,
                                  leaf: true,
                                  leftImgSrc:
                                    "../assets/icons/knowledge-base.svg",
                                },
                              ],
                            },
                          ],
                        },
                        {
                          id: "new-item-added-5",
                          caption: "new-item-added-5",
                          disabled: true,
                          expanded: true,
                          leaf: false,
                          leftImgSrc: "../assets/icons/knowledge-base.svg",
                          items: [
                            {
                              id: "new-item-added-5-1",
                              caption: "new-item-added-5-1",
                              disabled: false,
                              leaf: true,
                              leftImgSrc: "../assets/icons/knowledge-base.svg",
                            },
                            {
                              id: "new-item-added-5-2",
                              caption: "new-item-added-5-2",
                              disabled: true,
                              leaf: true,
                              leftImgSrc: "../assets/icons/knowledge-base.svg",
                            },
                          ],
                        },
                      ],
                    },
                    {
                      id: "number-1-1-2-2",
                      caption: "number-1-1-2-2",
                      leaf: true,
                      leftImgSrc: "../assets/icons/knowledge-base.svg",
                    },
                  ],
                },
              ],
            },
            {
              id: "number-1-2",
              caption: "number-1-2",
              leaf: true,
              leftImgSrc: "../assets/icons/knowledge-base.svg",
            },
          ],
        },
        {
          id: "number-2",
          caption: "number-2",
          leaf: false,
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-2-1",
              caption: "number-2-1",
              leaf: true,
              leftImgSrc: "/build/ch-icon-assets/patterns.svg",
            },
            {
              id: "number-2-2",
              caption: "number-2-2",
              leaf: true,
              leftImgSrc: "../assets/icons/patterns.svg",
            },
            {
              id: "number-2-3",
              caption: "number-2-3",
              disabled: true,
              leaf: true,
              leftImgSrc: "../assets/icons/patterns.svg",
            },
          ],
        },
        {
          id: "number-3",
          caption: "number-3",
          leaf: false,
          disabled: true,
          expanded: true,
          leftImgSrc: "../assets/icons/datastore.svg",
          items: [
            {
              id: "number-3-1",
              caption: "number-3-1",
              leaf: true,
              leftImgSrc: "/build/ch-icon-assets/patterns.svg",
            },
            {
              id: "number-3-2",
              caption: "number-3-2",
              disabled: true,
              leaf: true,
              leftImgSrc: "../assets/icons/patterns.svg",
            },
            {
              id: "number-3-3",
              caption: "number-3-3",
              leaf: true,
              leftImgSrc: "../assets/icons/patterns.svg",
            },
          ],
        },
      ];
      const modelLazyUpdated1 = [
        {
          id: "lazy-loaded-1",
          caption: "Lazy Loaded 1",
          leaf: true,
          leftImgSrc: "../assets/icons/patterns.svg",
          checkbox: true,
        },
        {
          id: "lazy-loaded-2",
          caption: "Lazy Loaded 2 (lazy)",
          leaf: false,
          lazy: true,
          leftImgSrc: "../assets/icons/patterns.svg",
          checkbox: true,
          toggleCheckboxes: true,
        },
      ];

      const modelLazyUpdated2 = [
        {
          id: "lazy-loaded-3",
          caption: "Lazy Loaded 3",
          leaf: true,
          leftImgSrc: "../assets/icons/patterns.svg",
          checkbox: true,
        },
        {
          id: "lazy-loaded-4",
          caption: "Lazy Loaded 4",
          leaf: true,
          leftImgSrc: "../assets/icons/patterns.svg",
          checkbox: true,
        },
      ];

      const bigModel = [];

      const FIRST_LEVEL_SIZE = 10;
      const SECOND_LEVEL_SIZE = 20;
      const THIRD_LEVEL_SIZE = 20;

      for (let i = 0; i < FIRST_LEVEL_SIZE; i++) {
        bigModel.push({
          id: "item-" + i,
          caption: "item-" + i,
          lazy: true,
          leaf: false,
          checkbox: true,
          leftImgSrc: "../assets/icons/patterns.svg",
          items: [],
        });
      }

      const eagerLargeModel = [];

      for (let i = 0; i < FIRST_LEVEL_SIZE; i++) {
        const subEagerLargeModel = [];
        const modelId = "item-" + i;

        for (let j = 0; j < SECOND_LEVEL_SIZE; j++) {
          const subModelId = modelId + "-" + j;
          const subSubEagerLargeModel = [];

          for (let k = 0; k < THIRD_LEVEL_SIZE; k++) {
            const subSubModelId = subModelId + "-" + k;

            subSubEagerLargeModel.push({
              id: subSubModelId,
              caption: subSubModelId,
              leaf: true,
              leftImgSrc: "../assets/icons/file.svg",
            });
          }

          subEagerLargeModel.push({
            id: subModelId,
            caption: subModelId,
            expanded: true,
            leaf: false,
            leftImgSrc: "../assets/icons/knowledge-base.svg",
            items: subSubEagerLargeModel,
          });
        }

        eagerLargeModel.push({
          id: modelId,
          caption: modelId,
          expanded: true,
          leaf: false,
          leftImgSrc: "../assets/icons/patterns.svg",
          items: subEagerLargeModel,
        });
      }
    </script>
    <br />

    <script>
      const modelMinimal = [
        {
          id: "number-2-2",
          caption: "number-2-2",
          leftImgSrc: "../assets/icons/knowledge-base.svg",
        },
      ];

      // WA to remove extra handlers in appload event
      let appLoadFinish = false;

      window.addEventListener("appload", () => {
        if (appLoadFinish) {
          return;
        }

        appLoadFinish = true;

        const testTreeX = document.querySelector("gxg-tree-view");

        testTreeX.treeModel = {
          items: bigModel,
        };

        const multiSelectionCheckbox = document.getElementById(
          "multi-selection"
        );
        multiSelectionCheckbox.addEventListener("input", (event) => {
          testTreeX.multiSelection = event.target.checked;
        });

        const checkAllCheckbox = document.getElementById("check-all");
        checkAllCheckbox.addEventListener("input", (event) => {
          const checked = event.target.checked;

          testTreeX.updateAllItemsProperties({ checked: checked });
        });

        const expandAllBtn = document.getElementById("expand-all");
        expandAllBtn.addEventListener("click", (event) => {
          testTreeX.updateAllItemsProperties({ expanded: true });
        });

        const collapseAllBtn = document.getElementById("collapse-all");
        collapseAllBtn.addEventListener("click", (event) => {
          testTreeX.updateAllItemsProperties({ expanded: false });
        });

        const linesSelect = document.getElementById("lines");
        linesSelect.addEventListener("input", (event) => {
          const selectedOption = event.target.value;
          testTreeX.showLines = selectedOption;
        });

        const loadModelBtn = document.getElementById("load-model-btn");
        loadModelBtn.addEventListener("click", () => {
          testTreeX.treeModel = {
            items: model,
          };
        });

        const updateModelBtn = document.getElementById("update-model-btn");
        updateModelBtn.addEventListener("click", () => {
          testTreeX.treeModel = {
            items: updatedModel,
          };
        });

        const updateModelAgainBtn = document.getElementById(
          "update-model-again-btn"
        );
        updateModelAgainBtn.addEventListener("click", () => {
          testTreeX.treeModel = {
            items: modelTinyUpdatedAgain,
          };
        });

        const updateBigModelBtn = document.getElementById(
          "update-big-model-btn"
        );
        updateBigModelBtn.addEventListener("click", () => {
          testTreeX.treeModel = {
            items: bigModel,
          };
        });

        const scrollIntoVisibleBtn = document.getElementById(
          "btn-scroll-into-visible"
        );
        const scrollIntoVisibleInput = document.getElementById(
          "input-scroll-into-visible"
        );

        scrollIntoVisibleBtn.addEventListener("click", () => {
          testTreeX.scrollIntoVisible(scrollIntoVisibleInput.value);
          scrollIntoVisibleInput.value = "";
        });

        /*Lazy Load Promise*/
        testTreeX.lazyLoadTreeItemsCallback = (modelId) =>
          new Promise((resolve, reject) => {
            let lazyModel =
              modelId === "lazy-loaded-2"
                ? modelLazyUpdated2
                : modelLazyUpdated1;

            if (modelId.startsWith("item-")) {
              lazyModel = [];

              for (let j = 0; j < SECOND_LEVEL_SIZE; j++) {
                const subModelId = modelId + "-" + j;
                const subModelItems = [];

                for (let k = 0; k < THIRD_LEVEL_SIZE; k++) {
                  subModelItems.push({
                    id: subModelId + "-" + k,
                    caption: subModelId + "-" + k,
                    leaf: true,
                    leftImgSrc: "../assets/icons/file.svg",
                  });
                }

                lazyModel.push({
                  id: subModelId,
                  caption: subModelId,
                  expanded: true,
                  leaf: false,
                  leftImgSrc: "../assets/icons/knowledge-base.svg",
                  items: subModelItems,
                });
              }
            }

            setTimeout(() => {
              resolve(lazyModel);
            }, 1000); // Resolves or rejects after 1 second
          });

        testTreeX.dropItemsCallback = () =>
          new Promise((resolve, reject) => {
            setTimeout(() => {
              resolve({ acceptDrop: true, items: modelTiny });
            }, 25); // Resolves after 25 ms
          });

        let randomSuccess = true;

        testTreeX.modifyItemCaptionCallback = (treeItemId, newCaption) =>
          new Promise((resolve, reject) => {
            const status = newCaption.trim() !== "" && randomSuccess;
            // randomSuccess = !randomSuccess;

            setTimeout(() => {
              resolve({
                success: status,
                errorMessage:
                  "Apologies, an error ocurred while changing the item caption.",
              });
            }, 15); // Resolves after 15 ms
          });

        let randomAccept = true;

        testTreeX.checkDroppableZoneCallback = () =>
          new Promise((resolve, reject) => {
            const accept = randomAccept;
            // randomAccept = !randomAccept;

            setTimeout(() => {
              resolve(randomAccept);
            }, 500); // Resolves after 500 ms
          });

        /**
         * @typedef TreeXItemModel
         * @type {object}
         * @property {string} id
         * @property {string} caption
         */
        /**
         * @param {TreeXItemModel[]} subModel
         */
        const sortItems = (subModel) =>
          subModel.sort((a, b) => (a.caption < b.caption ? -1 : 0));

        testTreeX.sortItemsCallback = sortItems;

        // Eager large model
        // testTreeX.treeModel = {
        //   items: eagerLargeModel
        // };
      });
    </script>
  </body>
</html>
